<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>FVTool ([FVM, Matlab])</title><link>http://fvt.simulkade.com/</link><description></description><atom:link href="http://fvt.simulkade.com/categories/cat_fvm-matlab.xml" type="application/rss+xml" rel="self"></atom:link><language>en</language><lastBuildDate>Wed, 28 Oct 2015 19:28:38 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>A simple finite volume toolbox for Matlab</title><link>http://fvt.simulkade.com/posts/2014-05-20-a-simple-finite-volume-toolbox-for-matlab.html</link><dc:creator>AAE</dc:creator><description>&lt;div&gt;&lt;h2&gt;An introduction to a Matlab FVM (toy) toolbox&lt;/h2&gt;
&lt;p&gt;For some reasons, I had to solve a few PDE's including single/multi phase flow in porous media, heat transfer in saturated porous media, multi-component mass transfer, and so on. My job never included the development of numerical method. In fact, I was supposed to come up with simple and useful models for the physical system that I was/am studying. Solving those models could be done in PDE solver of my choice. At the end of the day, I chose to write my own codes in Matlab.&lt;/p&gt;
&lt;h3&gt;Why [in general]?&lt;/h3&gt;
&lt;p&gt;Let me count my reasons here. In case you don't like to listen to me bragging about it, you can skip to the middle of this post.&lt;/p&gt;
&lt;h4&gt;Black-boxes&lt;/h4&gt;
&lt;p&gt;These numerical solvers, in particular &lt;a href="http://www.comsol.com"&gt;COMSOL&lt;/a&gt; always was like a black-box to me. I could not understand its error messages, which was frustrating, and even when it generated nice results (which most of the times happens), I was really unable to have a physical feeling for it. I will talk about the physical feeling later, and don't expect a post about love-making.&lt;/p&gt;
&lt;h4&gt;Boundary conditions&lt;/h4&gt;
&lt;p&gt;For some reason, choosing and handling boundary conditions is not explained in books, or papers, or lectures. The same situation applies to the documentation of PDE solvers. Id it really that difficult for you guys to bring us a general Robin boundary condition?&lt;/p&gt;
&lt;h4&gt;Geometry&lt;/h4&gt;
&lt;p&gt;Honestly, one of the most attractive features of PDE solvers is the graphical pre-processor (with all sort of different mesh generation techniques) and CAD modules. For me, with the simple rectangular or cylindrical geometries of my experimental set-up, there was no need of a fancy pre-processor.&lt;/p&gt;
&lt;h4&gt;Learning/Teaching&lt;/h4&gt;
&lt;p&gt;I'll be doing a lot of teaching soon, so I needed to learn numerical methods. What's better than learning by doing? Now, I can share my experiences and my coode with my students.&lt;/p&gt;
&lt;h3&gt;Why [in particular]?&lt;/h3&gt;
&lt;p&gt;I needed a mass conservative scheme (e.g., &lt;a href="http://en.wikipedia.org/wiki/Finite_volume_method"&gt;finite volume method&lt;/a&gt;), which is implemented in an understandable language (yes, I know. C++ is quite beautiful and elegant and understandable even for a kid with the right genes, but I prefer Matlab), with some flexibility for specifying boundary conditions and changing the physics. I actually found a code. It's called &lt;a href="http://www.ctcms.nist.gov/fipy/"&gt;FiPy&lt;/a&gt;. But I was already comfortable with Matlab and, don't tell anyone, I couldn't understand &lt;a href="https://www.python.org/"&gt;Python&lt;/a&gt; and &lt;a href="http://www.numpy.org/"&gt;NumPy&lt;/a&gt;. So having FiPy's syntax in mind I decided to write my own code in Matlab. I think it is in good enough shape to be shared with other FVM/Matlab users.&lt;/p&gt;
&lt;h3&gt;Really! Why?&lt;/h3&gt;
&lt;p&gt;For most of our important PDE's in chemical and petroleum engineering (did I mention that I'm a chemical/petroleum engineer?) we have analytical solutions. Also, most of the experiments that we do in the lab can be modeled with a one dimensional PDE. However, so many curious things happen when we go to a two- or three-dimensional domain. I wanted to have something, like FiPy, to make me able to solve a 1D equation, verify it by comparing it to my analytical solution or experimental data, and switch it to 2D and 3D domains without too many modifications. I have it now.&lt;/p&gt;
&lt;h3&gt;What do we solve?&lt;/h3&gt;
&lt;p&gt;We solve this general form of transient convection-diffusion equation:&lt;/p&gt;
&lt;p&gt;$$ \alpha\frac{\partial\phi}{\partial t}+\nabla.\left(\mathbf{u}\phi\right)+\nabla.\left(-D\nabla\phi\right)+\beta\phi=\gamma$$ &lt;/p&gt;
&lt;p&gt;with the following general (Robin) boundary condition:&lt;/p&gt;
&lt;p&gt;$$a\nabla\phi.\mathbf{n}+b\phi=c.$$&lt;/p&gt;
&lt;p&gt;All of the coefficients can be defined explicitly for each control volume or on the surface of a control volume.&lt;/p&gt;
&lt;h3&gt;Where to find/How to use 'the code'?&lt;/h3&gt;
&lt;p&gt;You can download the code from this github repository (click on the &lt;code&gt;download zip&lt;/code&gt; button): &lt;a href="https://github.com/simulkade/FVTool"&gt;FVTool&lt;/a&gt;
Or alternatively, if you are on linux (and hopefully you are), use the command&lt;/p&gt;
&lt;pre class="code literal-block"&gt;git clone https://github.com/simulkade/FVTool
&lt;/pre&gt;


&lt;h4&gt;How to start&lt;/h4&gt;
&lt;p&gt;Start &lt;a href="http://www.matlab.com"&gt;Matlab&lt;/a&gt; (or &lt;a href="http://www.gnu.org/software/octave/"&gt;Octave&lt;/a&gt;), go to the &lt;code&gt;FVTool&lt;/code&gt; folder, and type &lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span class="n"&gt;FVToolStartUp&lt;/span&gt; 
&lt;/pre&gt;


&lt;p&gt;You must see a few messages and finally you should see &lt;code&gt;FiniteVolumeToolbox has started successfully.&lt;/code&gt; in Matlab command prompt.
With the following command, you can see a short document that introduces you to the code:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span class="n"&gt;showdemo&lt;/span&gt; &lt;span class="n"&gt;FVTdemo&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;If you want to jump into it, you can run the following script to solve a diffusion equation with Dirichlet boundary conditions:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Important Update&lt;/strong&gt;: this code does not work with the new version of FVTool. Download the old version &lt;a href="https://github.com/simulkade/FVTool/archive/v0.11.zip"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span class="n"&gt;clc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;clear&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;L&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c"&gt;% domain length&lt;/span&gt;
&lt;span class="n"&gt;Nx&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% number of cells&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;createMesh3D&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Nx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;Nx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;Nx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;BC&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;createBC&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% all Neumann boundary condition structure&lt;/span&gt;
&lt;span class="n"&gt;BC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;left&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;(:)&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;BC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;left&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;(:)=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;BC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;left&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(:)=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% Dirichlet for the left boundary&lt;/span&gt;
&lt;span class="n"&gt;BC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;right&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;(:)&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;BC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;right&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;(:)=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;BC&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;right&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(:)=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% right boundary&lt;/span&gt;
&lt;span class="n"&gt;D_val&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% value of the diffusion coefficient&lt;/span&gt;
&lt;span class="n"&gt;D&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;createCellVariable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;D_val&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% assign the diffusion coefficient to the cells&lt;/span&gt;
&lt;span class="n"&gt;D_face&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;harmonicMean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;D&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% calculate harmonic average of the diffusion coef on the cell faces&lt;/span&gt;
&lt;span class="n"&gt;Mdiff&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;diffusionTerm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;D_face&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% matrix of coefficients for the diffusion term&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Mbc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;RHSbc&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;boundaryCondition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;BC&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% matix of coefficients and RHS vector for the BC&lt;/span&gt;
&lt;span class="n"&gt;M&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Mdiff&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Mbc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% matrix of cefficients for the PDE&lt;/span&gt;
&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;solvePDE&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;RHSbc&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% send M and RHS to the solver&lt;/span&gt;
&lt;span class="n"&gt;visualizeCells&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% visualize the results&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;You can find more examples &lt;a href="https://github.com/simulkade/FVTool/tree/master/Examples/Tutorial"&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;</description><guid>http://fvt.simulkade.com/posts/2014-05-20-a-simple-finite-volume-toolbox-for-matlab.html</guid><pubDate>Tue, 20 May 2014 21:35:13 GMT</pubDate></item></channel></rss>